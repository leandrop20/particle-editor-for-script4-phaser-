Phaser.Plugin.EPSY=function(a,b){Phaser.Plugin.call(this,a,b),this.emitters=[],this.defaultTexture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACz0lEQVR42t2XP0hbURTGnfp/KK3QFiylCG11aRYpBQWFDiJCg266BNQtdnBQyOASQjp1KS4KGVw6iXMWEUdHUShkCBhSQpaQkJg/Jmm/H3xLEdtaWvLawMfJvfec79x77jnnvdfX96/9MpnM9VwudzOfz98qFAq3kYyZ/6tOi8XinVKpdLdSqfRXq9UHwsNarfYIyZh51tH7Y5s5Pj6+BqHI7+OsXq8/aTQag8LzZrM5JAwjGTPPOnroY4f9bzvPZrM3OBEnFPFTOXohvGy1WiPC6/Pz81FhDMmYedbRQx877OG5snPutFwu3zs7OxvQyZ6JPGSnE8KkMN1ut98KYSRjz094MyHssIcHviud3M4fE15OJuJxOZoSZoU5ISIsCIuWEc+zPoW+IzIED3y/FAnujLCxczt/JbI3Pum8sCQsCyudTmdVWEMy9vyS9cLYYe9NDMD705wgcbg7h33Ezmd8wqidrgtxISm8t4x7ns1ErT/jTYzABy/8Pyw1spcE4g4d9rDJ3ok8JiSED8KGsClsWW54nvUY+rYL+zpC8MJ/aYmyO0qILCaRfOfzPnnMJ/0opIRPwk63291FepzyetKbiNp+Cj544b80CtwRdUwpkc1OqCWHPWHybTtNS+5LHlimPb9tvYSvg5yYhQ9e+PFzWfj7aSa++0ln9bLvlvCm7GRP8lDySDhBerzn9ZT1152Yc/A5Fwbxc+EaqFPaKR3N9T7tO1xxgm04zJz0UPis/6fCFyRjbyJtPfTjro4IfPDCj58LfYEHCllKydDZ3GQWHP6kE23H4T6y05Jk1fLUkdh3TmzabtV9gmY1Cj9+8PfdBniqOQGHaa/O/kXXOaW25fAeOOycvPpVP6THJ86JXVcHdmtuVlTDGPz4wV+wItDzHOh5FfS8DwSiE/b8WdDzp2Eg3gd6/kYUiHfCQLwVB+K7IBBfRoH5Nvyvf98A3rZr7fen7G8AAAAASUVORK5CYII=",this._sortFn=function(a,b){return(a.__z||0)-(b.__z||0)};var c=this;this._onResume=function(){for(var a=0;a<c.emitters.length;a++)c.emitters[a].lastTimestamp=Date.now()},a.onResume.add(this._onResume,this),this.game.epsy=this},Phaser.Plugin.EPSY.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.EPSY.prototype.constructor=Phaser.Plugin.EPSY,Phaser.Plugin.EPSY.VERSION="0.5.1";var updateParticle=function(a,b){b.sprite||(b.sprite=PIXI.Sprite.fromImage(b.texture||this.defaultTexture),b.sprite.__parentParticle=b,b.sprite.anchor.x=.5,b.sprite.anchor.y=.5,b.sprite.tail=0,b.ready=!0),b.inserted||(b.inserted=!0,a.buffer.push(b.sprite),a.container.addChild(b.sprite)),b.sprite.width=b.radius*b.scale,b.sprite.height=b.radius*b.scale,b.sprite.position.x=b.pos.x,b.sprite.position.y=b.pos.y,b.sprite.blendMode=b.textureAdditive?PIXI.blendModes.ADD:PIXI.blendModes.NORMAL,b.sprite.tint=~~b.color[2]+256*~~b.color[1]+65536*~~b.color[0],b.sprite.alpha=b.color[3]};Phaser.Plugin.EPSY.Emitter=function(a,b){PIXI.DisplayObjectContainer.call(this),this.particleSystem=a,this.emitter=b},Phaser.Plugin.EPSY.Emitter.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),Phaser.Plugin.EPSY.Emitter.prototype.constructor=Phaser.Plugin.EPSY.Emitter,Phaser.Plugin.EPSY.Emitter.prototype.preUpdate=function(){},Phaser.Plugin.EPSY.Emitter.prototype.postUpdate=function(){},Phaser.Plugin.EPSY.Emitter.prototype.destroy=function(){},Phaser.Plugin.EPSY.Emitter.prototype.update=function(){var a=Date.now(),b=a-(this.__ez_parent.lastTimestamp||a);this.__ez_parent.lastTimestamp=a,b/=1e3;var c=this.emitter;c.update(b);for(var d=0;d<c.particles.length;++d){var e=c.particles[d];e.life>0&&e.color&&updateParticle.call(this.particleSystem,c,e)}},Phaser.Plugin.EPSY.Emitter.prototype.reset=function(){var a=this.emitter.buffer,b=this.emitter.container;do{var c=a.pop();c&&(b.removeChild(c),c.__parentParticle&&(c.__parentParticle.inserted=!1))}while(a.length>0)},Phaser.Plugin.EPSY.prototype.createEmitter=function(a,b,c){b=b||0,c=c||0;var d=new EPSY.Emitter(a);return d.buffer=[],d.settings.pos.x=0,d.settings.pos.y=0,this.emitters.push(d),d.container=new Phaser.Plugin.EPSY.Emitter(this,d),d.container.position.x=b,d.container.position.y=c,d.zIndex=a.zIndex,d.container.__ez_parent=d,d.lastTimestamp=Date.now(),d.container},Phaser.Plugin.EPSY.prototype.loadSystem=function(a,b,c){b=b||0,c=c||0;var d,e=game.add.group();d="string"==typeof a?JSON.parse(_data):"object"!=typeof a||a instanceof Array?a:[a];for(var f=0;f<d.length;f++){var a=d[f],g=this.createEmitter(a,a.pos.x,a.pos.y);e.add(g)}return e.position.x=b,e.position.y=c,e.children.sort(this._sortFn),e};